#!/usr/bin/env bash
set -euo pipefail

echo "=== Setting up {{ project_name }} ==="

# Check for Docker
if ! command -v docker &> /dev/null; then
    echo "ERROR: Docker is not installed. Please install Docker first."
    exit 1
fi

if ! command -v docker compose &> /dev/null; then
    echo "ERROR: Docker Compose is not available. Please install Docker Compose v2."
    exit 1
fi

# Copy environment files if they don't exist
cp -n .env.example .env 2>/dev/null || true
cp -n .env.development .env.dev 2>/dev/null || true

echo "Environment files created."

# Build development containers
echo "Building development containers..."
docker compose -f docker-compose.dev.yml build

echo ""
echo "=== Setup Complete ==="
echo "Run 'make dev' to start the development environment."
echo ""
echo "Services will be available at:"
echo "  Frontend:  http://localhost:{{ ports.frontend }}"
echo "  Backend:   http://localhost:{{ ports.backend }}"
echo "  API Docs:  http://localhost:{{ ports.backend }}/docs"
echo "  MongoDB:   localhost:{{ ports.mongodb }}"
echo "  Redis:     localhost:{{ ports.redis }}"
{% if auth_required %}
echo "  KeyCloak:  http://localhost:{{ ports.keycloak }}"
{% endif %}
